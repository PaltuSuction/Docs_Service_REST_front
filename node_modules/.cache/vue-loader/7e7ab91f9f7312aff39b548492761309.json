{"remainingRequest":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/src/components/LoginForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/src/components/LoginForm.vue","mtime":1589385484271},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICdheGlvcycKaW1wb3J0IHJvdXRlciBmcm9tICIuLi9yb3V0ZXIvaW5kZXgiOwppbXBvcnQgc3RvcmUgZnJvbSAiLi4vc3RvcmUiOwoKZXhwb3J0IGRlZmF1bHQgewogIGRhdGE6IGZ1bmN0aW9uICgpIHsKICAgIHJldHVybiB7CiAgICAgIGVtYWlsOiAnJywKICAgICAgZW1haWxfc3RhdGU6IG51bGwsCiAgICAgIHBhc3N3b3JkOiAnJywKICAgICAgcGFzc3dvcmRfc3RhdGU6IG51bGwsCiAgICAgIHRva2VuOiBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgndXNlci10b2tlbicpIHx8IG51bGwsCiAgICAgIGVycm9yOiBmYWxzZQogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgbG9naW46IGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5lcnJvciA9IGZhbHNlCiAgICAgIHRoaXMuZW1haWxfc3RhdGUgPSBudWxsCiAgICAgIHRoaXMucGFzc3dvcmRfc3RhdGUgPSBudWxsCiAgICAgIGlmICh0aGlzLmVtYWlsID09PSAnJykgdGhpcy5lbWFpbF9zdGF0ZSA9IGZhbHNlCiAgICAgIGVsc2UgdGhpcy5lbWFpbF9zdGF0ZSA9IG51bGwKICAgICAgaWYgKHRoaXMucGFzc3dvcmQgPT09ICcnKSB0aGlzLnBhc3N3b3JkX3N0YXRlID0gZmFsc2UKICAgICAgZWxzZSB0aGlzLnBhc3N3b3JkX3N0YXRlID0gbnVsbAogICAgICBpZiAodGhpcy5lbWFpbF9zdGF0ZSA9PT0gZmFsc2UgfHwgdGhpcy5wYXNzd29yZF9zdGF0ZSA9PT0gZmFsc2UpIHJldHVybgoKICAgICAgbGV0IGVtYWlsID0gdGhpcy5lbWFpbAogICAgICBsZXQgcGFzc3dvcmQgPSB0aGlzLnBhc3N3b3JkCiAgICAgIGF4aW9zKHt1cmw6ICdodHRwOi8vbG9jYWxob3N0OjYwNjAvYXV0aC8nLCBkYXRhOiB7ZW1haWwsIHBhc3N3b3JkfSwgbWV0aG9kOiAnUE9TVCd9KQogICAgICAgIC50aGVuKHJlc3AgPT4gewogICAgICAgICAgaWYgKHJlc3AuZGF0YS5yZXN1bHQgPT09ICdvaycpIHsKICAgICAgICAgICAgbGV0IHVzZXJfaW5mbyA9IHsndG9rZW4nOiByZXNwLmRhdGEucGFyYW1zLnRva2VuLCAndXNlcic6IHJlc3AuZGF0YS5wYXJhbXMudXNlciB9CiAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd1c2VyLXRva2VuJywgdXNlcl9pbmZvWyd0b2tlbiddKQogICAgICAgICAgICBheGlvcy5kZWZhdWx0cy5oZWFkZXJzLmNvbW1vblsnQXV0aG9yaXphdGlvbiddID0gJ1Rva2VuICcgKyByZXNwLmRhdGEucGFyYW1zLnRva2VuCiAgICAgICAgICAgIHN0b3JlLmNvbW1pdCgnYXV0aF9zdWNjZXNzJywgdXNlcl9pbmZvKQogICAgICAgICAgICByb3V0ZXIucHVzaCgnLycpCiAgICAgICAgICB9CiAgICAgICAgICBlbHNlIHsKICAgICAgICAgICBzdG9yZS5jb21taXQoJ2F1dGhfZXJyb3InLCByZXNwLmRhdGEucmVzdWx0KQogICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCd1c2VyLXRva2VuJykKICAgICAgICAgICAgdGhpcy5lcnJvciA9IHRydWUKICAgICAgICAgIH0KICAgICAgICB9KQogICAgfSwKICB9LAogIGNyZWF0ZWQoKSB7CiAgICBpZiAobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3VzZXItdG9rZW4nKSAhPT0gbnVsbCkgewogICAgICByb3V0ZXIucHVzaCh7bmFtZTogJ2hvbWUnfSkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["LoginForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"LoginForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <div>\n    <b-card class=\"login-card\">\n      <b-card-title>\n        <header class=\"\">\n          <p>Вход</p>\n        </header>\n        <b-card-sub-title v-if=\"error\" class=\"error-subtitle\">Ошибка. Проверьте введенные данные.</b-card-sub-title>\n      </b-card-title>\n      <b-card-body>\n        <b-form-input type=\"email\" name=\"email\" v-model=\"email\" :state=\"email_state\" @change=\"email_state = null\" placeholder=\"Email пользователя\" required></b-form-input>\n        <b-form-input  type=\"password\" name=\"password\" v-model=\"password\" :state=\"password_state\" @change=\"password_state = null\" placeholder=\"Пароль\" required class=\"mt-3\"/>\n      </b-card-body>\n      <b-card-footer>\n        <b-button squared class=\"button is-primary\" @click='login'>Войти</b-button>\n        <br/>\n        <b-link class=\"button is-primary\" @click=\"$router.push({name: 'registrationForm'})\">Регистрация</b-link>\n      </b-card-footer>\n    </b-card>\n  </div>\n</template>\n\n<script>\n    import axios from 'axios'\n    import router from \"../router/index\";\n    import store from \"../store\";\n\n    export default {\n      data: function () {\n        return {\n          email: '',\n          email_state: null,\n          password: '',\n          password_state: null,\n          token: localStorage.getItem('user-token') || null,\n          error: false\n        }\n      },\n      methods: {\n        login: async function () {\n          this.error = false\n          this.email_state = null\n          this.password_state = null\n          if (this.email === '') this.email_state = false\n          else this.email_state = null\n          if (this.password === '') this.password_state = false\n          else this.password_state = null\n          if (this.email_state === false || this.password_state === false) return\n\n          let email = this.email\n          let password = this.password\n          axios({url: 'http://localhost:6060/auth/', data: {email, password}, method: 'POST'})\n            .then(resp => {\n              if (resp.data.result === 'ok') {\n                let user_info = {'token': resp.data.params.token, 'user': resp.data.params.user }\n                localStorage.setItem('user-token', user_info['token'])\n                axios.defaults.headers.common['Authorization'] = 'Token ' + resp.data.params.token\n                store.commit('auth_success', user_info)\n                router.push('/')\n              }\n              else {\n               store.commit('auth_error', resp.data.result)\n               localStorage.removeItem('user-token')\n                this.error = true\n              }\n            })\n        },\n      },\n      created() {\n        if (localStorage.getItem('user-token') !== null) {\n          router.push({name: 'home'})\n        }\n      }\n    }\n</script>\n\n\n\n<style scoped>\n  .login-card {\n    width: 400px;\n    max-height: 300px;\n    position: absolute;\n    top: calc(50% - 150px);\n    left: calc(50% - 200px);\n  }\n .login-card .error-subtitle {\n    position: absolute;\n    left: 0;\n    right: 0;\n    margin-left: auto;\n    margin-right: auto;\n    width: 300px; /* Need a specific value to work */\n }\n</style>"]}]}