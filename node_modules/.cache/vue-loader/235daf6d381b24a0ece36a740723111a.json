{"remainingRequest":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/src/components/RegistrationForm.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/src/components/RegistrationForm.vue","mtime":1588636596858},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/paltus/PycharmProjects/Docs_Service_REST_v2/tablegenfront/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CmltcG9ydCByb3V0ZXIgZnJvbSAiLi4vcm91dGVyL2luZGV4IjsKaW1wb3J0IHN0b3JlIGZyb20gIi4uL3N0b3JlIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiUmVnaXN0cmF0aW9uRm9ybSIsCiAgZGF0YTogZnVuY3Rpb24gKCkgewogICAgcmV0dXJuIHsKICAgICAgc3RvcmU6IHN0b3JlLAogICAgICBlbWFpbDogJycsCiAgICAgIGZpbzoge2ZpcnN0X25hbWU6ICcnLCBtaWRkbGVfbmFtZTogJycsIGxhc3RfbmFtZTogJyd9LAogICAgICBhbGxfZmFjdWx0aWVzOiBbXSwKICAgICAgdGVhY2hlcl9mYWN1bHR5OiAnJywKICAgICAgZmFjdWx0eV9zdHVkeWluZ19kaXJlY3Rpb25zOiBbXSwKICAgICAgc2VsZWN0ZWRfc3R1ZHlpbmdfZGlyZWN0aW9uczogW10sCiAgICAgIHBhc3N3b3JkOiAnJywKICAgICAgcGFzc3dvcmQyOiAnJywKICAgICAgaXNfdGVhY2hlcjogdHJ1ZSwKICAgICAgaXNfc3R1ZGVudDogZmFsc2UsCiAgICAgIGlzX3N0YWZmOiBmYWxzZSwKCiAgICAgIGVtYWlsX3N0YXRlOiBudWxsLAogICAgICBmaW9fc3RhdGU6IG51bGwsCiAgICAgIGZhY3VsdHlfc3RhdGU6IG51bGwsCiAgICAgIGRpcmVjdHNfc3RhdGU6IG51bGwsCiAgICAgIHBhc3N3b3Jkc19zdGF0ZTogbnVsbCwKICAgICAgZXJyb3I6IGZhbHNlLAogICAgICBlcnJvcl90ZXh0OiAnJwogICAgfQogIH0sCiAgbWV0aG9kczogewogICAgcmVnaXN0ZXI6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5lcnJvciA9IGZhbHNlCiAgICAgIHRoaXMuZmlvX3N0YXRlID0gdGhpcy5lbWFpbF9zdGF0ZSA9IHRoaXMuZmFjdWx0eV9zdGF0ZSA9IHRoaXMuZGlyZWN0c19zdGF0ZSA9IHRoaXMucGFzc3dvcmRzX3N0YXRlID0gbnVsbAogICAgICBpZiAodGhpcy5maXJzdF9uYW1lID09PSAnJyB8fCB0aGlzLmxhc3RfbmFtZSA9PT0gJycpIHRoaXMuZmlvX3N0YXRlID0gZmFsc2UKICAgICAgaWYgKHRoaXMuZW1haWwgPT09ICcnKSB0aGlzLmVtYWlsX3N0YXRlID0gZmFsc2UKICAgICAgaWYgKHRoaXMudGVhY2hlcl9mYWN1bHR5ID09PSAnJykgdGhpcy5mYWN1bHR5X3N0YXRlID0gZmFsc2UKICAgICAgaWYgKHRoaXMuc2VsZWN0ZWRfc3R1ZHlpbmdfZGlyZWN0aW9ucyA9PT0gJycpIHRoaXMuZGlyZWN0c19zdGF0ZSA9IGZhbHNlCiAgICAgIGlmICh0aGlzLnBhc3N3b3JkID09PSAnJyB8fCB0aGlzLnBhc3N3b3JkMiA9PT0gJycpIHsKICAgICAgICB0aGlzLnBhc3N3b3Jkc19zdGF0ZSA9IGZhbHNlCiAgICAgIH0KICAgICAgaWYgKHRoaXMucGFzc3dvcmQgIT09IHRoaXMucGFzc3dvcmQyKSB7CiAgICAgICAgdGhpcy5wYXNzd29yZHNfc3RhdGUgPSBmYWxzZQogICAgICB9CiAgICAgIGlmICh0aGlzLmZpb19zdGF0ZSA9PT0gZmFsc2UgfHwgdGhpcy5lbWFpbF9zdGF0ZSA9PT0gZmFsc2UgfHwgdGhpcy5mYWN1bHR5X3N0YXRlID09PSBmYWxzZSB8fCB0aGlzLmRpcmVjdHNfc3RhdGUgPT09IGZhbHNlIHx8IHRoaXMucGFzc3dvcmRzX3N0YXRlID09PSBmYWxzZSkgewogICAgICAgIHRoaXMuZXJyb3IgPSB0cnVlCiAgICAgICAgcmV0dXJuCiAgICAgIH0KICAgICAgbGV0IG5ld191c2VyID0gewogICAgICAgICB1c2VybmFtZTogdGhpcy5lbWFpbCwKICAgICAgICAgZmlyc3RfbmFtZTogdGhpcy5maW8uZmlyc3RfbmFtZSwKICAgICAgICAgbGFzdF9uYW1lOiB0aGlzLmZpby5sYXN0X25hbWUsCiAgICAgICAgIG1pZGRsZV9uYW1lOiB0aGlzLmZpby5taWRkbGVfbmFtZSwKICAgICAgICAgc3R1ZHlpbmdfZGlyZWN0aW9uczogdGhpcy5zZWxlY3RlZF9zdHVkeWluZ19kaXJlY3Rpb25zLAogICAgICAgICBpc190ZWFjaGVyOiB0aGlzLmlzX3RlYWNoZXIsCiAgICAgICAgIGlzX3N0dWRlbnQ6IHRoaXMuaXNfc3R1ZGVudCwKICAgICAgICAgaXNfc3RhZmY6IHRoaXMuaXNfc3RhZmYsCiAgICAgICAgIHBhc3N3b3JkOiB0aGlzLnBhc3N3b3JkLAogICAgICAgICBwYXNzd29yZDI6IHRoaXMucGFzc3dvcmQyLAogICAgICB9CgogICAgICBzdG9yZS5jb21taXQoJ2F1dGhfcmVxdWVzdCcpCiAgICAgIGF4aW9zKHt1cmw6ICdodHRwOi8vbG9jYWxob3N0OjYwNjAvYXBpL3JlZ2lzdHJhdGlvbi8nLCBkYXRhOiBuZXdfdXNlciwgbWV0aG9kOiAnUE9TVCcgfSkKICAgICAgLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgICBpZiAocmVzcC5kYXRhLnJlc3VsdCA9PT0gJ29rJykgewogICAgICAgICAgICBsZXQgdXNlcl9pbmZvID0geyd0b2tlbic6IHJlc3AuZGF0YS5wYXJhbXMudG9rZW4sICd1c2VyJzogcmVzcC5kYXRhLnBhcmFtcy51c2VyIH0KICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3VzZXItdG9rZW4nLCB1c2VyX2luZm9bJ3Rva2VuJ10pCiAgICAgICAgICAgIGF4aW9zLmRlZmF1bHRzLmhlYWRlcnMuY29tbW9uWydBdXRob3JpemF0aW9uJ10gPSAnVG9rZW4gJyArIHJlc3AuZGF0YS5wYXJhbXMudG9rZW4KICAgICAgICAgICAgc3RvcmUuY29tbWl0KCdhdXRoX3N1Y2Nlc3MnLCB1c2VyX2luZm8pCiAgICAgICAgICAgIHJvdXRlci5wdXNoKCcvJykKICAgICAgICAgICAgLy8gcmVzb2x2ZShyZXNwKQogICAgICAgICAgfQogICAgICAgICAgZWxzZSB7CiAgICAgICAgICAgc3RvcmUuY29tbWl0KCdhdXRoX2Vycm9yJywgcmVzcC5kYXRhLnJlc3VsdCkKICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgndXNlci10b2tlbicpCiAgICAgICAgICAgdGhpcy5lcnJvciA9IHRydWUKICAgICAgICAgIH0KICAgICAgICB9KQogICAgICAgIC8vIHRoaXMuJHN0b3JlLmRpc3BhdGNoKCdyZWdpc3RlcicsIGRhdGEpCiAgICB9LAogICAgc2V0X3N0dWR5X2RpcmVjdHM6IGZ1bmN0aW9uICgpIHsKICAgICAgdGhpcy5mYWN1bHR5X3N0YXRlID0gbnVsbAogICAgICAgZm9yIChsZXQgZGlyZWN0aW9uIG9mIHRoaXMudGVhY2hlcl9mYWN1bHR5LmRpcmVjdGlvbnNfbmFtZXNfb25fZmFjdWx0eSkgewogICAgICAgIHRoaXMuZmFjdWx0eV9zdHVkeWluZ19kaXJlY3Rpb25zLnB1c2goZGlyZWN0aW9uLm5hbWUpCiAgICAgICB9CiAgICB9CiAgfSwKICBjcmVhdGVkOiBmdW5jdGlvbiAoKSB7CiAgICBheGlvcy5nZXQoJ2h0dHA6Ly9sb2NhbGhvc3Q6NjA2MC9hcGkvZmFjdWx0aWVzX2FuZF9kaXJlY3RzJykKICAgICAgLnRoZW4ocmVzcCA9PiB7CiAgICAgICAgICBpZiAocmVzcC5kYXRhLnJlc3VsdCA9PT0gJ29rJykgewogICAgICAgICAgICAgIHRoaXMuYWxsX2ZhY3VsdGllcyA9IHJlc3AuZGF0YS5wYXJhbXMuZGF0YQogICAgICAgICAgICB9CiAgICAgICAgICAgIGVsc2UgewogICAgICAgICAgICAgIGNvbnNvbGUubG9nKCfQntGI0LjQsdC60LAg0L/RgNC4INC30LDQs9GA0YPQt9C60LUg0LTQsNC90L3Ri9GFINGE0LDQutGD0LvRjNGC0LXRgtC+0LInKQogICAgICAgICAgICB9CiAgICAgIH0KICAgICkKICB9Cn0K"},{"version":3,"sources":["RegistrationForm.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"RegistrationForm.vue","sourceRoot":"src/components","sourcesContent":["<template>\n  <b-card class=\"register-card\">\n    <b-card-title>\n      <header class=\"\">\n          <p class=\"\">Регистрация</p>\n      </header>\n      <b-card-sub-title v-if=\"error\" class=\"error-subtitle\">Ошибка. Проверьте введенные данные.</b-card-sub-title>\n    </b-card-title>\n    <b-card-body>\n      <b-form-input type=\"email\" name=\"email\" v-model=\"email\" placeholder=\"Email\" required class=\"mt-2\" :state=\"email_state\" @change=\"email_state = null\"/>\n      <b-form-input type=\"text\" name=\"last_name\" v-model=\"fio.last_name\" placeholder=\"Фамилия\" required class=\"mt-2\" :state=\"fio_state\" @change=\"fio_state = null\"/>\n      <b-form-input type=\"text\" name=\"first_name\" v-model=\"fio.first_name\" placeholder=\"Имя\" required class=\"mt-2\" :state=\"fio_state\" @change=\"fio_state = null\"/>\n      <b-form-input type=\"text\" name=\"middle_name\" v-model=\"fio.middle_name\" placeholder=\"Отчество\" required class=\"mt-2\"></b-form-input>\n      <b-form-select v-model=\"teacher_faculty\" class=\"mt-2\" @change=\"set_study_directs\" :state=\"faculty_state\">\n        <b-form-select-option v-for=\"faculty in all_faculties\" v-bind:value=\"faculty\">{{ store.state.faculty_decryption[faculty.name] }}</b-form-select-option>\n      </b-form-select>\n      <b-form-group label=\"Преподаваемые направления\" class=\"mt-2\">\n        <b-form-select v-model=\"selected_studying_directions\" multiple :state=\"directs_state\" @change=\"directs_state = null\">\n          <b-form-select-option v-for=\"direction_name in faculty_studying_directions\" v-bind:value=\"direction_name\">\n            {{store.state.direction_decryption[direction_name]}}\n          </b-form-select-option>\n        </b-form-select>\n      </b-form-group>\n      <b-form-input type=\"password\" name=\"password\" v-model=\"password\" placeholder=\"Пароль\" required class=\"mt-2\" :state=\"passwords_state\" @change=\"passwords_state = null\"/>\n      <b-form-input type=\"password\" name=\"password2\" v-model=\"password2\" placeholder=\"Пароль (ещё раз)\" required class=\"mt-2\" :state=\"passwords_state\" @change=\"passwords_state = null\"/>\n    </b-card-body>\n    <b-card-footer>\n      <b-button squared class=\"button is-primary\" @click='register()'>Зарегистрироваться</b-button>\n      <br/>\n      Уже есть аккаунт? <b-link class=\"button is-primary\" @click=\"$router.push({name: 'loginForm'})\">Войти</b-link>\n    </b-card-footer>\n  </b-card>\n</template>\n\n<script>\n    import axios from \"axios\";\n    import router from \"../router/index\";\n    import store from \"../store\";\n\n    export default {\n      name: \"RegistrationForm\",\n      data: function () {\n        return {\n          store: store,\n          email: '',\n          fio: {first_name: '', middle_name: '', last_name: ''},\n          all_faculties: [],\n          teacher_faculty: '',\n          faculty_studying_directions: [],\n          selected_studying_directions: [],\n          password: '',\n          password2: '',\n          is_teacher: true,\n          is_student: false,\n          is_staff: false,\n\n          email_state: null,\n          fio_state: null,\n          faculty_state: null,\n          directs_state: null,\n          passwords_state: null,\n          error: false,\n          error_text: ''\n        }\n      },\n      methods: {\n        register: function () {\n          this.error = false\n          this.fio_state = this.email_state = this.faculty_state = this.directs_state = this.passwords_state = null\n          if (this.first_name === '' || this.last_name === '') this.fio_state = false\n          if (this.email === '') this.email_state = false\n          if (this.teacher_faculty === '') this.faculty_state = false\n          if (this.selected_studying_directions === '') this.directs_state = false\n          if (this.password === '' || this.password2 === '') {\n            this.passwords_state = false\n          }\n          if (this.password !== this.password2) {\n            this.passwords_state = false\n          }\n          if (this.fio_state === false || this.email_state === false || this.faculty_state === false || this.directs_state === false || this.passwords_state === false) {\n            this.error = true\n            return\n          }\n          let new_user = {\n             username: this.email,\n             first_name: this.fio.first_name,\n             last_name: this.fio.last_name,\n             middle_name: this.fio.middle_name,\n             studying_directions: this.selected_studying_directions,\n             is_teacher: this.is_teacher,\n             is_student: this.is_student,\n             is_staff: this.is_staff,\n             password: this.password,\n             password2: this.password2,\n          }\n\n          store.commit('auth_request')\n          axios({url: 'http://localhost:6060/api/registration/', data: new_user, method: 'POST' })\n          .then(resp => {\n              if (resp.data.result === 'ok') {\n                let user_info = {'token': resp.data.params.token, 'user': resp.data.params.user }\n                localStorage.setItem('user-token', user_info['token'])\n                axios.defaults.headers.common['Authorization'] = 'Token ' + resp.data.params.token\n                store.commit('auth_success', user_info)\n                router.push('/')\n                // resolve(resp)\n              }\n              else {\n               store.commit('auth_error', resp.data.result)\n               localStorage.removeItem('user-token')\n               this.error = true\n              }\n            })\n            // this.$store.dispatch('register', data)\n        },\n        set_study_directs: function () {\n          this.faculty_state = null\n           for (let direction of this.teacher_faculty.directions_names_on_faculty) {\n            this.faculty_studying_directions.push(direction.name)\n           }\n        }\n      },\n      created: function () {\n        axios.get('http://localhost:6060/api/faculties_and_directs')\n          .then(resp => {\n              if (resp.data.result === 'ok') {\n                  this.all_faculties = resp.data.params.data\n                }\n                else {\n                  console.log('Ошибка при загрузке данных факультетов')\n                }\n          }\n        )\n      }\n    }\n</script>\n\n<style scoped>\n\n  .register-card {\n    width: 400px;\n    height: 650px;\n    position: absolute;\n    top: calc(50% - 325px);\n    left: calc(50% - 200px);\n  }\n  .register-card .error-subtitle {\n    position: absolute;\n    left: 0;\n    right: 0;\n    margin-left: auto;\n    margin-right: auto;\n    width: 300px; /* Need a specific value to work */\n }\n</style>"]}]}